<VirtualHost *:1443>
    ServerAdmin {{ server_admin }}
    ServerName {{ server_name }}
    {% if server_alias is defined %}
        ServerAlias {{ server_alias }}
    {% endif %}
    DocumentRoot {{ server_document_root }}

    <Directory {{ server_document_root }}>
        Options +Indexes  +FollowSymLinks
        DirectoryIndex app.php
        AllowOverride All

        {% if add_basic_auth == true %}
            AuthType Basic
            AuthName "Restricted Content"
            AuthUserFile /home/{{ user }}/auth/passwdfile
            Require valid-user
        {% else %}
            Require all-granted
        {% endif %}
    </Directory>

    <IfModule mpm_itk_module>
        AssignUserId {{ user }} www-data
    </IfModule>

    ErrorLog ${APACHE_LOG_DIR}/{{ user }}-error.log

    # Possible values include: debug, info, notice, warn, error, crit,
    # alert, emerg.
    LogLevel warn

    CustomLog ${APACHE_LOG_DIR}/{{ user }}-access.log combined


    CustomLog ${APACHE_LOG_DIR}/colibri-green-access.log combined

    SSLEngine ON
    SSLCertificateFile /home/letsencrypt/letsencrypt.sh/certs/lecomptoir.bluebear.fr/fullchain.pem
    SSLCertificateKeyFile /home/letsencrypt/letsencrypt.sh/certs/lecomptoir.bluebear.fr/privkey.pem
    SSLCertificateChainFile /home/letsencrypt/letsencrypt.sh/certs/lecomptoir.bluebear.fr/chain.pem

    Include /etc/letsencrypt/options-ssl-apache.conf

</VirtualHost>


<VirtualHost *:8080>
    ServerAdmin {{ server_admin }}
    ServerName {{ server_name }}
    {% if server_alias is defined %}
        ServerAlias {{ server_alias }}
    {% endif %}
    DocumentRoot {{ server_document_root }}

    <Directory {{ server_document_root }}>
        Options +Indexes  +FollowSymLinks
        DirectoryIndex app.php
        AllowOverride All

        {% if add_basic_auth == true %}
            AuthType Basic
            AuthName "Restricted Content"
            AuthUserFile /home/{{ user }}/auth/passwdfile
            Require valid-user
        {% else %}
            Require all-granted
        {% endif %}
    </Directory>

    <IfModule mpm_itk_module>
        AssignUserId {{ user }} www-data
    </IfModule>

    ErrorLog ${APACHE_LOG_DIR}/{{ user }}-error.log

    # Possible values include: debug, info, notice, warn, error, crit,
    # alert, emerg.
    LogLevel warn

    CustomLog ${APACHE_LOG_DIR}/{{ user }}-access.log combined
</VirtualHost>
